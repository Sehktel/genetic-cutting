<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Linear cut genetic optimizer</title>
	<script src="lib/genetic.js"></script>
    <script src="src/cutting.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body>

<h1>Linear cut genetic optimizer</h1>

<table>
    <thead>
    <tr>
        <th>Изделия</th>
        <th>Заготовки</th>
        <th>Параметры</th>
    </tr>
    </thead>
    <tbody style="font-family: monospace;">
    <tr>
        <td><textarea id="products" style="width: 100px; height: 300px;">1356
1436
646
2266
1086
1626
1086
1626
1086
1626
1086
1626
1086
1626
586
1626
586
1626
1746
2666
1746
2666
1746
2666
1746
2666
1746
2666
1746
2666
1166
1746
1166
1746
1746
2666
1746
2666
1746
2666
1746
2666
1746
2666
1746
2666
1166
1746
1166
1746
666
1056
666
1056
666
1056
666
1056
666
1056
666
1056
646
1076</textarea></td>
    <td><textarea id="workpieces" style="width: 100px; height: 300px;">2058
1920
4768
1211
1711</textarea></td>
    <td><textarea id="params" style="width: 200px; height: 300px;">knifewidth 4
sticklength 6000
wrongsnipmin 0
wrongsnipmax 0
usefulscrap 600
iterations 10000
size 100
crossover 0.2
mutation 0.3
random 0.1
skip 40
webWorkers 1</textarea></td>
    </tr>
    </tbody>
</table>



<button id="solve">Solve</button>

<table id="results">
	<thead>
		<tr>
			<th style="width: 100px;">Generation</th>
			<th style="width: 200px;">Fitness</th>
			<th style="width: 100px;">Solution</th>
		</tr>
	</thead>
	<tbody style="font-family: monospace;">
	</tbody>
</table>

<script>

var cutting = new Genetic.Cutting("1D");

cutting.genetic.notification = function(pop, generation, stats, isFinished) {

    if (generation == 0)
        return;

    var decision = this.fitness(pop[0].entity, true);

    if(this.last == decision.scraps_percent){
        var row = $("#results tbody tr")[0];
        row.cells[0].innerHTML = generation;
        return;
    }

    this.last = decision.scraps_percent;

    var buf = "";
    buf += "<tr>";
    buf += "<td>" + generation + "</td>";
    buf += "<td align='center'>" + (pop[0].fitness / 10e8).toFixed(5) + " " + decision.workpieces.length + "</td>";
    buf += "<td>" + decision.scraps_percent.toFixed(3) + "</td>";
    buf += "</tr>";
    $("#results tbody").prepend(buf);
};


$(document).ready(function () {
	$("#solve").click(function () {
		
		$("#results tbody").html("");
		
		var config = {
			iterations: 3000,
            size: 200,
            crossover: 0.3,
            mutation: 0.3,
            skip: 60,
            webWorkers: true
		};

        var userData = {
            products: $("#products").val().split("\n").map(function(v){return parseInt(v)}),
            workpieces: $("#workpieces").val().split("\n").map(function(v){return parseInt(v)}),
            knifewidth: 4,
            sticklength: 6000,
            wrongsnipmin: 0,
            wrongsnipmax: 0,
            usefulscrap: 600
        };

        $("#params").val().split("\n").forEach(function (v) {

            var prm = v.split(" ");

            if(config.hasOwnProperty(prm[0]))
                config[prm[0]] = parseFloat(prm[1]);

            else if(userData.hasOwnProperty(prm[0]))
                userData[prm[0]] = parseFloat(prm[1]);
        });


        cutting.genetic.evolve(config, userData);
	});
});


</script>
	
	
</body>
</html>